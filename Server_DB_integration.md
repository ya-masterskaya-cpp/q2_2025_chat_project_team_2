### Описание интеграции Сервера и Базы Данных
Сервер использует гибридную модель с кэшированием, где база данных выступает в роли основного, "долговечного" хранилища, а структуры данных в оперативной памяти — в роли "горячего" кэша для обеспечения быстрой работы.
#### 1. Инициализация (при старте сервера)
- Полная предзагрузка: Сервер выполняет два полных "холодных" чтения из БД для инициализации своих кэшей:
- Кэш паролей: Все пары "логин-пароль" загружаются в users_passwords_.
- Кэш членства в комнатах: Все существующие связи "пользователь-комната" загружаются в members_who_wrote_.
- Инициализация general: Сервер гарантирует, что основная комната general существует в БД.
#### 2. Запись в БД (событийная модель)
  Данные записываются в базу данных по мере возникновения событий в чате:
- Регистрация (register_user): Создает нового пользователя в БД и сразу же добавляет его в комнату general.
- Смена имени (change_name): Обновляет имя пользователя в БД.
- Создание комнаты (create_room): Создает новую комнату в БД и сразу привязывает к ней создателя.
- Первое сообщение (shuttle): Создает связь "пользователь-комната" в БД, только когда пользователь впервые пишет в эту комнату.
- Сохранение истории (shuttle): Каждое общее (GENERAL) сообщение сохраняется в историю чата в БД.
#### 3. Чтение из БД (модель "по запросу" и "ленивая" загрузка)
  Кроме полной загрузки при старте, сервер обращается к БД для чтения в следующих случаях:
- Проверка существования (register_user, create_room): Перед созданием новой сущности сервер проверяет db_->IsUser() или db_->IsRoom(), чтобы избежать конфликтов.
- Получение списка комнат (ask_rooms): Возвращает клиенту объединенный список: все активные комнаты из кэша в памяти + все комнаты, в которых пользователь состоит (согласно БД).
- "Ленивая" активация комнат (enter_room): Если пользователь пытается войти в комнату, которой нет в памяти, но она есть в БД, сервер "активирует" ее, создавая запись в кэше users_.
- Получение актуальных данных (add_user): При первом входе пользователя его актуальный никнейм загружается из БД для инициализации сессии.
